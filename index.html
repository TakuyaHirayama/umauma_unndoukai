<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¦ãƒã‚¦ãƒé‹å‹•ä¼š</title>
<style>
body {
  background: radial-gradient(circle, #222, #000);
  color: white;
  font-family: sans-serif;
  text-align: center;
}
h1 { font-size: 42px; }
.horse {
  margin: 15px auto;
  width: 85%;
}
.bar {
  height: 26px;
  background: #444;
  border-radius: 20px;
  overflow: hidden;
}
.progress {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #00ffcc, #00ff66, #ffee00);
  transition: width 0.1s;
}
button, select {
  font-size: 18px;
  padding: 8px 15px;
  margin: 10px;
}
#result {
  font-size: 48px;
  margin-top: 30px;
  text-shadow: 0 0 10px gold;
}
#rate {
  font-size: 22px;
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>ğŸ‡ ã‚¦ãƒã‚¦ãƒé‹å‹•ä¼š ğŸ</h1>

<div id="info"></div>

<select id="bet"></select>
<button onclick="startRace()">ãƒ¬ãƒ¼ã‚¹é–‹å§‹</button>

<div id="track"></div>
<div id="result"></div>
<div id="rate"></div>

<script>
const WORDS = [
  "é›·","é¢¨","å½±","ç‚","æ˜Ÿ","æœˆ","é‰„","ç–¾","å¤¢","åµ",
  "æ¡œ","éŠ€","è’¼","ç´…","å¤œ","å…‰","ç‰™","é›²"
];

let horses = [];
let positions = [];
let stamina = [];
let goal = 0;
let finished = false;
let winner = null;

let total = Number(localStorage.getItem("total")) || 0;
let hit = Number(localStorage.getItem("hit")) || 0;

function randomName() {
  return WORDS[Math.floor(Math.random()*WORDS.length)] +
         WORDS[Math.floor(Math.random()*WORDS.length)];
}

function setupRace() {
  horses = [];
  for (let i=0;i<4;i++) {
    horses.push({
      name: randomName(),
      speed: 4 + Math.random()*3,
      maxStamina: 80 + Math.random()*40
    });
  }
  goal = 800 + Math.random()*600;
}

function startRace() {
  setupRace();
  positions = [0,0,0,0];
  stamina = horses.map(h=>h.maxStamina);
  finished = false;
  winner = null;

  document.getElementById("result").textContent = "";
  document.getElementById("rate").textContent = "";

  document.getElementById("info").textContent =
    `ğŸ ä»Šå›ã®è·é›¢ï¼š${Math.floor(goal)}m`;

  const bet = document.getElementById("bet");
  bet.innerHTML = "";
  horses.forEach((h,i)=>{
    const o = document.createElement("option");
    o.value = i;
    o.textContent = `${h.name}ï¼ˆé€Ÿ:${h.speed.toFixed(1)} è€:${Math.floor(h.maxStamina)}ï¼‰`;
    bet.appendChild(o);
  });

  const track = document.getElementById("track");
  track.innerHTML = "";
  horses.forEach((h,i)=>{
    const div = document.createElement("div");
    div.className = "horse";
    div.innerHTML = `
      <div>${h.name}</div>
      <div class="bar"><div class="progress" id="p${i}"></div></div>
    `;
    track.appendChild(div);
  });

  requestAnimationFrame(runRace);
}

function runRace() {
  if (finished) return;

  horses.forEach((h,i)=>{
    if (positions[i] >= goal) return;

    stamina[i] -= 0.25;

    let staminaRate = stamina[i] / h.maxStamina;
    staminaRate = Math.max(0.3, staminaRate); // â­ æœ€ä½ä¿è¨¼

    const move =
      h.speed *
      (0.85 + Math.random()*0.3) *
      staminaRate;

    positions[i] += move;

    const percent = Math.min(positions[i]/goal*100, 100);
    document.getElementById(`p${i}`).style.width = percent + "%";

    if (positions[i] >= goal && !finished) {
      finished = true;
      winner = i;
      showResult();
    }
  });

  if (!finished) requestAnimationFrame(runRace);
}

function showResult() {
  const bet = Number(document.getElementById("bet").value);
  total++;

  if (bet === winner) hit++;

  localStorage.setItem("total", total);
  localStorage.setItem("hit", hit);

  document.getElementById("result").textContent =
    `ğŸ† å‹è€…ï¼š${horses[winner].name} ğŸ†`;

  document.getElementById("rate").textContent =
    bet === winner
      ? `ğŸ‰ çš„ä¸­ï¼ï¼ï¼ˆ${hit}/${total}ï¼‰`
      : `ğŸ’¥ ãƒã‚ºãƒ¬ï¼ï¼ˆ${hit}/${total}ï¼‰`;
}
</script>

</body>
</html>

</body>
</html>
