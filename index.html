<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ğŸ´ ã†ã¾ã†ã¾é‹å‹•ä¼š ğŸ´</title>

<style>
body {
  background: linear-gradient(180deg,#fff0f6,#e0f7ff);
  font-family: "Rounded Mplus 1c", sans-serif;
  text-align: center;
  color: #444;
}

h1 {
  font-size: 44px;
  color: #ff6fa5;
  text-shadow: 2px 2px #fff;
}

.card {
  background: white;
  border-radius: 25px;
  padding: 20px;
  margin: 15px auto;
  width: 85%;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.horse-name {
  font-size: 22px;
  margin-bottom: 6px;
}

.bar {
  background: #eee;
  height: 24px;
  border-radius: 20px;
  overflow: hidden;
}

.progress {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg,#ff9a9e,#fad0c4,#fbc2eb,#a1c4fd);
}

select {
  font-size: 20px;
  padding: 8px;
  border-radius: 15px;
}

#result {
  font-size: 52px;
  margin-top: 25px;
  color: #ff7b00;
  text-shadow: 0 0 12px gold;
}

#rate {
  font-size: 22px;
}
</style>
</head>

<body>

<h1>ğŸ´ ã†ã¾ã†ã¾é‹å‹•ä¼š ğŸ</h1>

<div class="card" id="info"></div>

<select id="bet"></select>

<div id="track"></div>

<div id="result"></div>
<div id="rate"></div>

<script>
const A = ["ã‚‚ãµã‚‚ãµ","ã½ã‚ˆã½ã‚ˆ","ãµã‚ãµã‚","ãã‚‰ãã‚‰","ã«ã“ã«ã“"];
const B = ["ã•ãã‚‰","ã ã„ãµã","ã«ã‚“ã˜ã‚“","ãŠã‚‚ã¡","ã‚‰ã„ã¨"];

let horses=[],pos=[],stamina=[],goal,winner,finished=false;

let total=Number(localStorage.getItem("t"))||0;
let hit=Number(localStorage.getItem("h"))||0;

const randName=()=>A[Math.floor(Math.random()*A.length)]
              +B[Math.floor(Math.random()*B.length)];

function newRace(){
  horses=[];
  for(let i=0;i<4;i++){
    horses.push({
      name:randName(),
      speed:4+Math.random()*3,
      maxStamina:90+Math.random()*40
    });
  }
  goal=700+Math.random()*500;
  pos=[0,0,0,0];
  stamina=horses.map(h=>h.maxStamina);
  finished=false;
  winner=null;

  document.getElementById("info").textContent=
    `ğŸ ä»Šå›ã®è·é›¢ï¼š${Math.floor(goal)}m`;

  const bet=document.getElementById("bet");
  bet.innerHTML="";
  horses.forEach((h,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=`${h.name}ï¼ˆé€Ÿ${h.speed.toFixed(1)}ï¼‰`;
    bet.appendChild(o);
  });

  const track=document.getElementById("track");
  track.innerHTML="";
  horses.forEach((h,i)=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <div class="horse-name">${h.name}</div>
      <div class="bar"><div class="progress" id="p${i}"></div></div>
    `;
    track.appendChild(c);
  });

  document.getElementById("result").textContent="";
  document.getElementById("rate").textContent="";

  requestAnimationFrame(run);
}

function run(){
  if(finished)return;

  horses.forEach((h,i)=>{
    if(pos[i]>=goal)return;

    stamina[i]-=0.25;
    let s=Math.max(0.35,stamina[i]/h.maxStamina);

    pos[i]+=h.speed*(0.9+Math.random()*0.3)*s;
    document.getElementById(`p${i}`).style.width=
      Math.min(pos[i]/goal*100,100)+"%";

    if(pos[i]>=goal&&!finished){
      finished=true;
      winner=i;
      showResult();
    }
  });

  if(!finished)requestAnimationFrame(run);
}

function showResult(){
  const bet=Number(document.getElementById("bet").value);
  total++;
  if(bet===winner)hit++;

  localStorage.setItem("t",total);
  localStorage.setItem("h",hit);

  document.getElementById("result").textContent=
    `ğŸ† ${horses[winner].name} ã‹ã¡ã£ï¼`;

  document.getElementById("rate").textContent=
    `ğŸ¯ çš„ä¸­ç‡ ${hit}/${total}`;

  setTimeout(newRace,3000); // â­ è‡ªå‹•æ¬¡ãƒ¬ãƒ¼ã‚¹
}

newRace();
</script>

</body>
</html>
