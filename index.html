<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ğŸ´ ã†ã¾ã†ã¾é‹å‹•ä¼š ğŸ´</title>

<style>
body{
  background:linear-gradient(#fff0f6,#e0f7ff);
  font-family:"Rounded Mplus 1c",sans-serif;
  text-align:center;
  color:#444;
}
h1{
  font-size:42px;
  color:#ff6fa5;
}
.card{
  background:white;
  border-radius:25px;
  padding:15px;
  margin:15px auto;
  width:85%;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
}
.bar{
  height:22px;
  background:#eee;
  border-radius:20px;
  overflow:hidden;
}
.progress{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#ff9a9e,#fad0c4,#a1c4fd);
}
button,select{
  font-size:20px;
  padding:10px 18px;
  border-radius:20px;
  border:none;
  margin:10px;
}
button{
  background:#ff8fb1;
  color:white;
  cursor:pointer;
}
button:disabled{
  opacity:.5;
}
#result{
  font-size:48px;
  margin-top:20px;
  color:#ff7b00;
  text-shadow:0 0 10px gold;
}
</style>
</head>

<body>

<h1>ğŸ´ ã†ã¾ã†ã¾é‹å‹•ä¼š ğŸ</h1>

<div class="card" id="info"></div>

<select id="bet"></select><br>
<button id="startBtn">ãƒ¬ãƒ¼ã‚¹é–‹å§‹ï¼</button>

<div id="track"></div>

<div id="result"></div>
<div id="rate"></div>

<script>
const A=["ã‚‚ãµã‚‚ãµ","ã½ã‚ˆã½ã‚ˆ","ãµã‚ãµã‚","ãã‚‰ãã‚‰","ã«ã“ã«ã“"];
const B=["ã•ãã‚‰","ã ã„ãµã","ã«ã‚“ã˜ã‚“","ãŠã‚‚ã¡","ã‚‰ã„ã¨"];

let horses=[],pos=[],stamina=[],goal;
let running=false,finished=false,winner=null;

let total=Number(localStorage.getItem("t"))||0;
let hit=Number(localStorage.getItem("h"))||0;

const randName=()=>A[Math.floor(Math.random()*A.length)]
                +B[Math.floor(Math.random()*B.length)];

function newRace(){
  horses=[];
  for(let i=0;i<4;i++){
    horses.push({
      name:randName(),
      speed:4+Math.random()*3,
      maxStamina:90+Math.random()*40
    });
  }

  goal=800+Math.random()*600;
  pos=[0,0,0,0];
  stamina=horses.map(h=>h.maxStamina);
  running=false; finished=false; winner=null;

  document.getElementById("info").textContent=
    `ğŸ è·é›¢ï¼š${Math.floor(goal)}m`;

  const bet=document.getElementById("bet");
  bet.innerHTML="";
  horses.forEach((h,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=
      `${h.name}ï½œé€Ÿ${h.speed.toFixed(1)}ï½œä½“${Math.floor(h.maxStamina)}`;
    bet.appendChild(o);
  });

  const track=document.getElementById("track");
  track.innerHTML="";
  horses.forEach((h,i)=>{
    track.innerHTML+=`
      <div class="card">
        <div>${h.name}</div>
        <div class="bar"><div class="progress" id="p${i}"></div></div>
      </div>`;
  });

  document.getElementById("result").textContent="";
  document.getElementById("rate").textContent="";
  document.getElementById("startBtn").disabled=false;
}

function startRace(){
  if(running)return;
  running=true;
  document.getElementById("startBtn").disabled=true;
  requestAnimationFrame(run);
}

function run(){
  if(finished)return;

  horses.forEach((h,i)=>{
    if(pos[i]>=goal)return;

    stamina[i]-=0.25;
    const rate=Math.max(0.4,stamina[i]/h.maxStamina);
    pos[i]+=h.speed*(0.9+Math.random()*0.3)*rate;

    document.getElementById(`p${i}`).style.width=
      Math.min(pos[i]/goal*100,100)+"%";

    if(pos[i]>=goal&&!finished){
      finished=true;
      winner=i;
      showResult();
    }
  });

  if(!finished)requestAnimationFrame(run);
}

function showResult(){
  const bet=Number(document.getElementById("bet").value);
  total++;
  if(bet===winner)hit++;

  localStorage.setItem("t",total);
  localStorage.setItem("h",hit);

  document.getElementById("result").textContent=
    `ğŸ† ${horses[winner].name} å‹åˆ©ï¼`;

  document.getElementById("rate").textContent=
    `ğŸ¯ çš„ä¸­ç‡ ${hit}/${total}`;

  setTimeout(newRace,3000);
}

document.getElementById("startBtn").onclick=startRace;
newRace();
</script>

</body>
</html>
