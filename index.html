<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¦ãƒã‚¦ãƒé‹å‹•ä¼š</title>
<style>
body {
  background: linear-gradient(#111, #333);
  color: white;
  font-family: sans-serif;
  text-align: center;
}
.horse {
  margin: 10px auto;
  width: 80%;
}
.bar {
  height: 28px;
  background: #444;
  border-radius: 20px;
  overflow: hidden;
}
.progress {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, gold, orange, red);
  transition: width 0.1s;
}
#result {
  font-size: 40px;
  margin-top: 30px;
}
button {
  font-size: 20px;
  padding: 10px 20px;
}
</style>
</head>

<body>

<h1>ğŸ‡ ã‚¦ãƒã‚¦ãƒé‹å‹•ä¼š ğŸ</h1>

<select id="bet">
  <option value="0">ã‚µãƒ³ãƒ€ãƒ¼</option>
  <option value="1">ãƒ–ãƒ¬ã‚¤ã‚º</option>
  <option value="2">ãƒŸãƒ©ãƒ¼ã‚¸ãƒ¥</option>
</select>

<button onclick="startRace()">ãƒ¬ãƒ¼ã‚¹é–‹å§‹</button>

<div id="track"></div>
<div id="result"></div>
<div id="rate"></div>

<script>
const GOAL = 1000;

let horses = [
  { name:"ã‚µãƒ³ãƒ€ãƒ¼", speed:6, stamina:100 },
  { name:"ãƒ–ãƒ¬ã‚¤ã‚º", speed:5.5, stamina:110 },
  { name:"ãƒŸãƒ©ãƒ¼ã‚¸ãƒ¥", speed:6.2, stamina:90 }
];

let positions, stamina, finished, winner;

function startRace() {
  // åˆæœŸåŒ–
  positions = [0,0,0];
  stamina = horses.map(h => h.stamina);
  finished = false;
  winner = null;

  document.getElementById("result").textContent = "";
  document.getElementById("rate").textContent = "";

  const track = document.getElementById("track");
  track.innerHTML = "";

  horses.forEach((h,i)=>{
    const div = document.createElement("div");
    div.className = "horse";
    div.innerHTML = `
      <div>${h.name}</div>
      <div class="bar"><div class="progress" id="p${i}"></div></div>
    `;
    track.appendChild(div);
  });

  requestAnimationFrame(runRace);
}

function runRace() {
  if (finished) return;

  horses.forEach((h,i)=>{
    if (positions[i] >= GOAL) return;

    // ã‚¹ã‚¿ãƒŸãƒŠå€ç‡
    let staminaRate = stamina[i] / h.stamina;
    if (staminaRate < 0.5) staminaRate *= 0.7;

    const move =
      h.speed *
      (0.8 + Math.random()*0.4) *
      staminaRate;

    positions[i] += move;
    stamina[i] -= 0.3;

    // ãƒãƒ¼æ›´æ–°
    const percent = Math.min(positions[i] / GOAL * 100, 100);
    document.getElementById(`p${i}`).style.width = percent + "%";

    if (positions[i] >= GOAL && !finished) {
      finished = true;
      winner = i;
      showResult();
    }
  });

  if (!finished) {
    requestAnimationFrame(runRace);
  }
}

function showResult() {
  const bet = Number(document.getElementById("bet").value);
  const winHorse = horses[winner].name;

  document.getElementById("result").textContent =
    `ğŸ† å‹è€…ï¼š${winHorse} ğŸ†`;

  document.getElementById("rate").textContent =
    bet === winner
      ? "ğŸ‰ çš„ä¸­ï¼ï¼ãŠã‚ã§ã¨ã‚¦ï¼ï¼"
      : "ğŸ’¥ ãƒã‚ºãƒ¬â€¦æ¬¡ã¯å‹ã¤ãƒ¨ğŸ˜¤";
}
</script>

</body>
</html>
